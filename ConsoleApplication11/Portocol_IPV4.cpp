#include "stdafx.h"


inline int Protocol_IPV4::length() {
	bitset<8> set(IP_HEADER.ucVersionHeaderLen);
	set &= bitset<8>(15);
	return ((int)set.to_ulong()) * 4;
}
inline int Protocol_IPV4::type() {
	return IP_HEADER.ucTypeOfProtocol;
}
inline Protocol_IPV4::Protocol_IPV4(u_char *_uBytes, int _iLength) {
	if (_iLength < 20) {
		return;
	}
	else {
		memcpy(&IP_HEADER, _uBytes, 20);
	}
	int iHeadLength = length();
	IP_BODY.packet = new u_char[_iLength - iHeadLength];
	memcpy(IP_BODY.packet, _uBytes + iHeadLength, _iLength - iHeadLength);

	cout << "IP: From: " << (int)IP_HEADER.ucSourIp[0] << "." << (int)IP_HEADER.ucSourIp[1] << ".";
	cout << (int)IP_HEADER.ucSourIp[2] << "." << (int)IP_HEADER.ucSourIp[3] << " To:";
	cout << (int)IP_HEADER.ucDestIp[0] << "." << (int)IP_HEADER.ucDestIp[1] << ".";
	cout << (int)IP_HEADER.ucDestIp[2] << "." << (int)IP_HEADER.ucDestIp[3]<<"  ";

	Protocols::ProtocolUnit new_protocol = Protocols::get_protocol(get_protocol_num(type()), IP_BODY.packet, _iLength - iHeadLength);
	delete new_protocol.oProtocol;
	delete IP_BODY.packet;
}
inline int Protocol_IPV4::get_protocol_num(int _iCode) {
	switch (_iCode)
	{
	case 1: return 1;
	case 2: return 2;
	case 3: return 3;
	case 4: return 4;
	case 5: return 5;
	case 6: return 6;
	case 7: return 7;
	case 8: return 8;
	case 9: return 9;
	case 10: return 10;
	case 11: return 11;
	case 12: return 12;
	case 13: return 13;
	case 14: return 14;
	case 15: return 15;
	case 16: return 16;
	case 17: return 17;
	case 18: return 18;
	case 19: return 19;
	case 20: return 20;
	case 21: return 21;
	case 22: return 22;
	case 23: return 23;
	case 24: return 24;
	case 25: return 25;
	case 26: return 26;
	case 27: return 27;
	case 28: return 28;
	case 29: return 29;
	case 30: return 30;
	case 31: return 31;
	case 32: return 32;
	case 33: return 33;
	case 34: return 34;
	case 35: return 35;
	case 36: return 36;
	case 37: return 37;
	case 38: return 38;
	case 39: return 39;
	case 40: return 40;
	case 41: return 41;
	case 42: return 42;
	case 43: return 43;
	case 44: return 44;
	case 45: return 45;
	case 46: return 46;
	case 47: return 47;
	case 48: return 48;
	case 49: return 49;
	case 50: return 50;
	case 51: return 51;
	case 52: return 52;
	case 53: return 53;
	case 54: return 54;
	case 55: return 55;
	case 56: return 56;
	case 57: return 57;
	case 58: return 58;
	case 59: return 59;
	case 60: return 60;
	case 61: return 61;
	case 62: return 62;
	case 63: return 63;
	case 64: return 64;
	case 65: return 65;
	case 66: return 66;
	case 67: return 67;
	case 68: return 68;
	case 69: return 69;
	case 70: return 70;
	case 71: return 71;
	case 72: return 72;
	case 73: return 73;
	case 74: return 74;
	case 75: return 75;
	case 76: return 76;
	case 77: return 77;
	case 78: return 78;
	case 79: return 79;
	case 80: return 80;
	case 81: return 81;
	case 82: return 82;
	case 83: return 83;
	case 84: return 84;
	case 85: return 85;
	case 86: return 86;
	case 87: return 87;
	case 88: return 88;
	case 89: return 89;
	case 90: return 90;
	case 91: return 91;
	case 92: return 92;
	case 93: return 93;
	case 94: return 94;
	case 95: return 95;
	case 96: return 96;
	case 97: return 97;
	case 98: return 98;
	case 99: return 99;
	case 100: return 100;
	case 101: return 101;
	case 102: return 102;
	case 103: return 103;
	case 104: return 104;
	case 105: return 105;
	case 106: return 106;
	case 107: return 107;
	case 108: return 108;
	case 109: return 109;
	case 110: return 110;
	case 111: return 111;
	case 112: return 112;
	case 113: return 113;
	case 114: return 114;
	case 115: return 115;
	case 116: return 116;
	case 117: return 117;
	case 118: return 118;
	case 119: return 119;
	case 120: return 120;
	case 121: return 121;
	case 122: return 122;
	case 123: return 123;
	case 124: return 124;
	case 125: return 125;
	case 126: return 126;
	case 127: return 127;
	case 128: return 128;
	case 129: return 129;
	case 130: return 130;
	case 131: return 131;
	case 132: return 132;
	case 133: return 133;
	case 134: return 134;
	case 135: return 135;
	case 136: return 136;
	case 137: return 137;
	case 138: return 138;
	case 139: return 138;
	case 140: return 138;
	case 141: return 138;
	case 142: return 138;
	case 143: return 138;
	case 144: return 138;
	case 145: return 138;
	case 146: return 138;
	case 147: return 138;
	case 148: return 138;
	case 149: return 138;
	case 150: return 138;
	case 151: return 138;
	case 152: return 138;
	case 153: return 138;
	case 154: return 138;
	case 155: return 138;
	case 156: return 138;
	case 157: return 138;
	case 158: return 138;
	case 159: return 138;
	case 160: return 138;
	case 161: return 138;
	case 162: return 138;
	case 163: return 138;
	case 164: return 138;
	case 165: return 138;
	case 166: return 138;
	case 167: return 138;
	case 168: return 138;
	case 169: return 138;
	case 170: return 138;
	case 171: return 138;
	case 172: return 138;
	case 173: return 138;
	case 174: return 138;
	case 175: return 138;
	case 176: return 138;
	case 177: return 138;
	case 178: return 138;
	case 179: return 138;
	case 180: return 138;
	case 181: return 138;
	case 182: return 138;
	case 183: return 138;
	case 184: return 138;
	case 185: return 138;
	case 186: return 138;
	case 187: return 138;
	case 188: return 138;
	case 189: return 138;
	case 190: return 138;
	case 191: return 138;
	case 192: return 138;
	case 193: return 138;
	case 194: return 138;
	case 195: return 138;
	case 196: return 138;
	case 197: return 138;
	case 198: return 138;
	case 199: return 138;
	case 200: return 138;
	case 201: return 138;
	case 202: return 138;
	case 203: return 138;
	case 204: return 138;
	case 205: return 138;
	case 206: return 138;
	case 207: return 138;
	case 208: return 138;
	case 209: return 138;
	case 210: return 138;
	case 211: return 138;
	case 212: return 138;
	case 213: return 138;
	case 214: return 138;
	case 215: return 138;
	case 216: return 138;
	case 217: return 138;
	case 218: return 138;
	case 219: return 138;
	case 220: return 138;
	case 221: return 138;
	case 222: return 138;
	case 223: return 138;
	case 224: return 138;
	case 225: return 138;
	case 226: return 138;
	case 227: return 138;
	case 228: return 138;
	case 229: return 138;
	case 230: return 138;
	case 231: return 138;
	case 232: return 138;
	case 233: return 138;
	case 234: return 138;
	case 235: return 138;
	case 236: return 138;
	case 237: return 138;
	case 238: return 138;
	case 239: return 138;
	case 240: return 138;
	case 241: return 138;
	case 242: return 138;
	case 243: return 138;
	case 244: return 138;
	case 245: return 138;
	case 246: return 138;
	case 247: return 138;
	case 248: return 138;
	case 249: return 138;
	case 250: return 138;
	case 251: return 138;
	case 252: return 138;
	case 253: return 139;
	case 254: return 139;
	case 255: return 140;
	default:return 255;
	}
}